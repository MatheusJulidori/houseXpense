services:
    postgres:
        ports:
            - "${POSTGRES_EXTERNAL_PORT:-5433}:5432"

    backend:
        build:
            context: ../server
            dockerfile: Dockerfile
            target: development
        user: "${DEV_UID:-1000}:${DEV_GID:-1000}"
        command: ["npm", "run", "start:dev"]
        environment:
            NODE_ENV: development
            PORT: ${SERVER_PORT_DEV:-3000}
        volumes:
            - ../server:/app
            - backend_node_modules:/app/node_modules
        ports:
            - "${SERVER_PORT_DEV:-3000}:3000"
        read_only: false
        tmpfs:
            - /tmp

    frontend:
        build:
            context: ../frontend
            dockerfile: Dockerfile
            target: development
        user: "${DEV_UID:-1000}:${DEV_GID:-1000}"
        command:
            ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "5173"]
        environment:
            NODE_ENV: development
            VITE_API_URL: http://backend:3000/api
        volumes:
            - ../frontend:/app
            - frontend_node_modules:/app/node_modules
        ports:
            - "${FRONTEND_PORT_DEV:-5173}:5173"
        read_only: false

volumes:
    backend_node_modules:
    frontend_node_modules:
